<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Product Management</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .product-card { border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1>GraphQL Product Management System</h1>

    <!-- Product Section -->
    <div class="section">
        <h2>Product Management</h2>

        <!-- Create Product Form -->
        <div class="form-group">
            <h3>Create New Product</h3>
            <form id="createProductForm">
                <label for="productTitle"></label><input type="text" id="productTitle" placeholder="Title" required>
                <label for="productQuantity"></label><input type="number" id="productQuantity" placeholder="Quantity" required>
                <label for="productDesc"></label><textarea id="productDesc" placeholder="Description" required></textarea>
                <label for="productPrice"></label><input type="number" step="0.01" id="productPrice" placeholder="Price" required>
                <label for="productUserId"></label><input type="number" id="productUserId" placeholder="User ID" required>
                <label for="productCategoryIds"></label><input type="text" id="productCategoryIds" placeholder="Category IDs (comma separated)" required>
                <button type="submit">Create Product</button>
            </form>
        </div>

        <!-- Product Actions -->
        <div class="form-group">
            <button onclick="getAllProducts()">Get All Products</button>
            <button onclick="getProductsByPriceAsc()">Get Products by Price (Low to High)</button>
            <label for="categoryIdFilter"></label><input type="number" id="categoryIdFilter" placeholder="Category ID">
            <button onclick="getProductsByCategory()">Get Products by Category</button>
        </div>

        <!-- Product Results -->
        <div id="productResult" class="result"></div>
    </div>

    <!-- User Section -->
    <div class="section">
        <h2>User Management</h2>

        <!-- Create User Form -->
        <div class="form-group">
            <h3>Create New User</h3>
            <form id="createUserForm">
                <label for="userFullname"></label><input type="text" id="userFullname" placeholder="Full Name" required>
                <label for="userEmail"></label><input type="email" id="userEmail" placeholder="Email" required>
                <label for="userPassword"></label><input type="password" id="userPassword" placeholder="Password" required>
                <label for="userPhone"></label><input type="tel" id="userPhone" placeholder="Phone" required>
                <button type="submit">Create User</button>
            </form>
        </div>

        <!-- User Actions -->
        <div class="form-group">
            <button onclick="getAllUsers()">Get All Users</button>
        </div>

        <!-- User Results -->
        <div id="userResult" class="result"></div>
    </div>

    <!-- Category Section -->
    <div class="section">
        <h2>Category Management</h2>

        <!-- Create Category Form -->
        <div class="form-group">
            <h3>Create New Category</h3>
            <form id="createCategoryForm">
                <label for="categoryName"></label><input type="text" id="categoryName" placeholder="Category Name" required>
                <label for="categoryImages"></label><input type="text" id="categoryImages" placeholder="Image URL" required>
                <button type="submit">Create Category</button>
            </form>
        </div>

        <!-- Category Actions -->
        <div class="form-group">
            <button onclick="getAllCategories()">Get All Categories</button>
        </div>

        <!-- Category Results -->
        <div id="categoryResult" class="result"></div>
    </div>
</div>

<script>
    const GRAPHQL_URL = 'http://localhost:8080/graphql';

    // GraphQL Utility Function
    async function graphqlQuery(query, variables = {}) {
        try {
            const response = await fetch(GRAPHQL_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    variables: variables
                })
            });

            const result = await response.json();
            if (result.errors) {
                throw new Error(result.errors[0].message);
            }
            return result.data;
        } catch (error) {
            console.error('GraphQL Error:', error);
            throw error;
        }
    }

    // Product Functions
    async function getAllProducts() {
        const query = `
                query {
                    getAllProducts {
                        id
                        title
                        quantity
                        description
                        price
                        user {
                            fullname
                            email
                        }
                        categories {
                            name
                        }
                    }
                }
            `;

        try {
            const data = await graphqlQuery(query);
            displayProducts(data.getAllProducts, 'productResult');
        } catch (error) {
            document.getElementById('productResult').innerHTML =
                `<div style="color: red;">Error: ${error.message}</div>`;
        }
    }

    async function getProductsByPriceAsc() {
        const query = `
                query {
                    getProductsByPriceAsc {
                        id
                        title
                        quantity
                        description
                        price
                        user {
                            fullname
                        }
                        categories {
                            name
                        }
                    }
                }
            `;

        try {
            const data = await graphqlQuery(query);
            displayProducts(data.getProductsByPriceAsc, 'productResult');
        } catch (error) {
            document.getElementById('productResult').innerHTML =
                `<div style="color: red;">Error: ${error.message}</div>`;
        }
    }

    async function getProductsByCategory() {
        const categoryId = document.getElementById('categoryIdFilter').value;
        if (!categoryId) {
            alert('Please enter a category ID');
            return;
        }

        const query = `
                query GetProductsByCategory($categoryId: ID!) {
                    getProductsByCategory(categoryId: $categoryId) {
                        id
                        title
                        quantity
                        description
                        price
                        user {
                            fullname
                        }
                        categories {
                            name
                        }
                    }
                }
            `;

        try {
            const data = await graphqlQuery(query, { categoryId: parseInt(categoryId) });
            displayProducts(data.getProductsByCategory, 'productResult');
        } catch (error) {
            document.getElementById('productResult').innerHTML =
                `<div style="color: red;">Error: ${error.message}</div>`;
        }
    }

    // User Functions
    async function getAllUsers() {
        const query = `
                query {
                    getAllUsers {
                        id
                        fullname
                        email
                        phone
                        products {
                            title
                            price
                        }
                    }
                }
            `;

        try {
            const data = await graphqlQuery(query);
            displayUsers(data.getAllUsers, 'userResult');
        } catch (error) {
            document.getElementById('userResult').innerHTML =
                `<div style="color: red;">Error: ${error.message}</div>`;
        }
    }

    // Category Functions
    async function getAllCategories() {
        const query = `
                query {
                    getAllCategories {
                        id
                        name
                        images
                        products {
                            title
                        }
                    }
                }
            `;

        try {
            const data = await graphqlQuery(query);
            displayCategories(data.getAllCategories, 'categoryResult');
        } catch (error) {
            document.getElementById('categoryResult').innerHTML =
                `<div style="color: red;">Error: ${error.message}</div>`;
        }
    }

    // Display Functions
    function displayProducts(products, elementId) {
        const container = document.getElementById(elementId);
        if (products.length === 0) {
            container.innerHTML = '<p>No products found</p>';
            return;
        }

        container.innerHTML = `
                <h3>Products (${products.length})</h3>
                <div class="product-grid">
                    ${products.map(product => `
                        <div class="product-card">
                            <h4>${product.title}</h4>
                            <p><strong>Price:</strong> $${product.price}</p>
                            <p><strong>Quantity:</strong> ${product.quantity}</p>
                            <p><strong>Description:</strong> ${product.description}</p>
                            <p><strong>Seller:</strong> ${product.user.fullname}</p>
                            <p><strong>Categories:</strong> ${product.categories.map(c => c.name).join(', ')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
    }

    function displayUsers(users, elementId) {
        const container = document.getElementById(elementId);
        if (users.length === 0) {
            container.innerHTML = '<p>No users found</p>';
            return;
        }

        container.innerHTML = `
                <h3>Users (${users.length})</h3>
                <div class="product-grid">
                    ${users.map(user => `
                        <div class="product-card">
                            <h4>${user.fullname}</h4>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Phone:</strong> ${user.phone}</p>
                            <p><strong>Products:</strong> ${user.products.length}</p>
                        </div>
                    `).join('')}
                </div>
            `;
    }

    function displayCategories(categories, elementId) {
        const container = document.getElementById(elementId);
        if (categories.length === 0) {
            container.innerHTML = '<p>No categories found</p>';
            return;
        }

        container.innerHTML = `
                <h3>Categories (${categories.length})</h3>
                <div class="product-grid">
                    ${categories.map(category => `
                        <div class="product-card">
                            <h4>${category.name}</h4>
                            <img src="${category.images}" alt="${category.name}" style="max-width: 100px;">
                            <p><strong>Products:</strong> ${category.products.length}</p>
                        </div>
                    `).join('')}
                </div>
            `;
    }

    // Form Handlers
    document.getElementById('createProductForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const mutation = `
                mutation CreateProduct($input: ProductInput!) {
                    createProduct(input: $input) {
                        id
                        title
                        price
                    }
                }
            `;

        const variables = {
            input: {
                title: document.getElementById('productTitle').value,
                quantity: parseInt(document.getElementById('productQuantity').value),
                description: document.getElementById('productDesc').value,
                price: parseFloat(document.getElementById('productPrice').value),
                userId: parseInt(document.getElementById('productUserId').value),
                categoryIds: document.getElementById('productCategoryIds').value.split(',').map(id => parseInt(id.trim()))
            }
        };

        try {
            await graphqlQuery(mutation, variables);
            alert('Product created successfully!');
            document.getElementById('createProductForm').reset();
            getAllProducts();
        } catch (error) {
            alert('Error creating product: ' + error.message);
        }
    });

    document.getElementById('createUserForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const mutation = `
                mutation CreateUser($input: UserInput!) {
                    createUser(input: $input) {
                        id
                        fullname
                        email
                    }
                }
            `;

        const variables = {
            input: {
                fullname: document.getElementById('userFullname').value,
                email: document.getElementById('userEmail').value,
                password: document.getElementById('userPassword').value,
                phone: document.getElementById('userPhone').value
            }
        };

        try {
            await graphqlQuery(mutation, variables);
            alert('User created successfully!');
            document.getElementById('createUserForm').reset();
            getAllUsers();
        } catch (error) {
            alert('Error creating user: ' + error.message);
        }
    });

    document.getElementById('createCategoryForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const mutation = `
                mutation CreateCategory($input: CategoryInput!) {
                    createCategory(input: $input) {
                        id
                        name
                        images
                    }
                }
            `;

        const variables = {
            input: {
                name: document.getElementById('categoryName').value,
                images: document.getElementById('categoryImages').value
            }
        };

        try {
            await graphqlQuery(mutation, variables);
            alert('Category created successfully!');
            document.getElementById('createCategoryForm').reset();
            getAllCategories();
        } catch (error) {
            alert('Error creating category: ' + error.message);
        }
    });

    // Load initial data
    window.onload = function() {
        getAllProducts();
        getAllUsers();
        getAllCategories();
    };
</script>
</body>
</html>